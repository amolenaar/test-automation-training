<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="style.css">
</head>
<body>

    <basket></basket>

    <catalog></catalog>

    <script src="basket.tag" type="riot/tag"></script>
    <script src="catalog.tag" type="riot/tag"></script>

    <script src="riot-compiler.min.js"></script>

    <!-- Load some demo data in our catalog -->
    <script>
        function Basket() {
            var self = this;
            riot.observable(this);
            self.entries = [];
            self.add = function(product) {
                for (var index in self.entries) {
                    if (self.entries[index].product === product) {
                        self.entries[index].quantity += 1;
                        self.trigger('updated');
                        return;
                    }
                }
                self.entries.push({ product: product, quantity: 1 });
                self.trigger('updated');
            };
            self.remove = function(product) {
                for (var index in self.entries) {
                    if (self.entries[index].product === product) {
                        if (self.entries[index].quantity > 1) {
                            self.entries[index].quantity -= 1;
                        } else {
                            self.entries.splice(index, 1);
                        }
                        self.trigger('updated');
                        break;
                    }
                }
            };
            self.checkout = function() {
                var total = 0;
                for (var index in self.entries) {
                    total += self.entries[index].quantity * self.entries[index].product.price;
                }
                if (total < 25) {
                    // Add shipping costs:
                    total += 2;
                }
                alert('Total price: ' + total.toFixed(2) + '.');
            };
        }

        var basket = new Basket();

        riot.mount('catalog', {
            items: [
                { name: 'Twenty Thousand Leagues Under the Sea', price: 9, category: 'BOOKS' },
                { name: 'Harry Potter and the Order of the Phoenix', price: 19, category: 'BOOKS' },
                { name: 'Pack of batteries', price: 5, category: 'ELECTRONICS' },
                { name: 'Fridge', price: 159, category: 'HOME_APPLIANCES' }
            ],
            basket: basket
        });
        riot.mount('basket', {
            basket: basket
        });
    </script>

</body>
</html>